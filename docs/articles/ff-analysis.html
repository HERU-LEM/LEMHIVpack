<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5 Analysis • LEMHIVpack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5 Analysis">
<meta property="og:description" content="LEMHIVpack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LEMHIVpack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aa-introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/bb-model_inputs.html">1 Model Inputs</a>
    </li>
    <li>
      <a href="../articles/cc-model_functions.html">2 Model Functions</a>
    </li>
    <li>
      <a href="../articles/dd-interventions.html">3 Interventions</a>
    </li>
    <li>
      <a href="../articles/ee-run_model.html">4 Run Model</a>
    </li>
    <li>
      <a href="../articles/ff-analysis.html">5 Analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HERU-LEM/LEMpackHIV/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ff-analysis_files/header-attrs-2.3.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5 Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/HERU-LEM/LEMpackHIV/blob/master/vignettes/ff-analysis.Rmd"><code>vignettes/ff-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>ff-analysis.Rmd</code></div>

    </div>

    
    
<p>In this section we use the model outcomes data and matrices generated in Section 4.0 to create tables and plots that can be used for interpretation of results. Users can modify these tables and plots to customize outputs for dissemination and publication. For more information about ggplot2, see <a href="https://ggplot2.tidyverse.org/">here</a>.</p>
<p><span class="math inline">\(~\)</span></p>
<div id="produce-cost-effectiveness-analysis-cea-results-table" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#produce-cost-effectiveness-analysis-cea-results-table" class="anchor"></a>5.0 Produce cost-effectiveness analysis (CEA) results table</h1>
<p>Using <em>CascadeCEA-Interventions-3-Analysis-CEATable(range).R</em> we produce a CEA table (<code>cea.table</code>) comparing the OCIS versus comparators. Users can specify whether CEA results for a single city or all cities should be produced. As there is no consensus threshold for WTP in the United States <span class="citation">(Woods et al. 2016)</span>, we have defined cost effective interventions as those with an ICER below $100,000/QALY. CE Results are output as .csv files. The following is a list of the CEA outcomes that are calculated:</p>
<ul>
<li>Incremental cost (point estimate, lower and upper bound)</li>
<li>Incremental QALYs (point estimate, lower and upper bound)</li>
<li>ICER (point estimate, lower and upper bound)</li>
<li>Percentage cost-effective</li>
<li>Percentage cost-saving</li>
</ul>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="disaggregated-cost-estimates" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#disaggregated-cost-estimates" class="anchor"></a>5.1 Disaggregated cost estimates</h1>
<p>In this component we derive and compare the disaggregated cost estimates for each city to identify strategies with the highest net monetary benefit (NMB).</p>
<p>First we derive the disaggregated cost estimates for each city’s selected OCIS using <em>CascadeCEA-Interventions-3-Analysis-CostBreakdown.R</em> found in <em>03_Analysis</em>. Following this, we determine the comparison strategies (strategies proximal to the OCIS) that we want to consider using the <em>CascadeCEA-Interventions-3-Analysis-DetermineProximalStrategies.R</em> script. The number of proximal strategies for comparison can be set, it is currently set to 10. Note that there are two options provided in this script, the first option (default option) determines proximal strategies according to NMB. However, if OCIS is determined as cost-saving but ICER is greater than $100,000 USD relative to the comparator, Option 2 must be used. Option 2 uses the distance to the NMB of the OCIS. When using Option 1, further analyses to estimate proportions of the selected combinations being most cost-effective can be done using <em>CascadeCEA-Interventions-3-Analysis-PSA-ProportionMostCE.R</em>. The results generated must be manually copied into Excel.</p>
<p>We then create a CEA frontier (also referred to as a “health production function” (HPF)), up to a given willingness-to-pay (WTP) level, by identifying strategies (combinations of interventions) with the highest NMB for each city or all cities. Creation of the HPF requires several steps and may take some time depending on how many strategies are considered, please be patient! Use <em>CascadeCEA-Interventions-3-Analysis-ProductionFunction.R</em> script for the following steps.</p>
<p>First we load the costs and QALY values for all strategies. Then we narrow down the number of strategies by conducting two screenings of all possible strategies - first screening removes strategies whose QALYs are lower than the least costly strategy, and the second screening removes strategies whose costs are higher than the strategy with highest QALYs.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># load the costs and QALY values for all strategies</span>
<span class="no">outcome.comb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Combination/Outcome-All-Combination-"</span>, <span class="no">CITY</span>, <span class="st">"-DM.rds"</span>))
<span class="no">outcome.ref</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Inputs/Combination-DM-"</span>, <span class="no">CITY</span>, <span class="st">"-refcase-outcomes.rds"</span>)))

<span class="no">CEmat</span>                          <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">outcome.ref</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"QALYs.sum"</span>, <span class="st">"costs.total.sum"</span>)], <span class="no">outcome.comb</span>[ , <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"QALYs.sum"</span>, <span class="st">"costs.total.sum"</span>)])
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">CEmat</span>)[<span class="fl">1</span>]             <span class="kw">&lt;-</span> <span class="st">"Ref"</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">CEmat</span>)[<span class="fl">2</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">CEmat</span>)] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">CEmat</span>)-<span class="fl">1</span>))
<span class="no">Strategy.ind</span>                   <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">CEmat</span>)[<span class="fl">1</span>]
<span class="no">CEmat</span>                          <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">Strategy.ind</span>, <span class="no">CEmat</span>)

<span class="co"># check for duplicated strategies</span>
<span class="no">dups</span> <span class="kw">&lt;-</span> <span class="no">CEmat</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(<span class="no">CEmat</span>[,<span class="fl">2</span>:<span class="fl">3</span>]) <span class="kw">|</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(<span class="no">CEmat</span>[,<span class="fl">2</span>:<span class="fl">3</span>], <span class="kw">fromLast</span> <span class="kw">=</span> <span class="fl">TRUE</span>)),<span class="fl">1</span>]

<span class="co"># initialize some variables</span>
<span class="no">costsCol</span> <span class="kw">&lt;-</span> <span class="fl">3</span>; <span class="no">qalyCol</span> <span class="kw">&lt;-</span> <span class="fl">2</span>

<span class="co"># 1st screening: remove stratgies whose QALYs are lower than the least costly strategy</span>
<span class="no">lowestcost</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="no">CEmat</span>[ , <span class="no">costsCol</span>]))
<span class="no">CEmat</span>       <span class="kw">&lt;-</span> <span class="no">CEmat</span>[(<span class="no">CEmat</span>[ ,<span class="no">qalyCol</span>] <span class="kw">&gt;=</span> <span class="no">CEmat</span>[<span class="no">lowestcost</span>,<span class="no">qalyCol</span>]), ]

<span class="co"># 2nd screening: remove stratgies whose costs are higher than the strategy with highest QALYs</span>
<span class="no">highestqaly</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(<span class="no">CEmat</span>[ , <span class="no">qalyCol</span>]))
<span class="no">CEmat</span>       <span class="kw">&lt;-</span> <span class="no">CEmat</span>[(<span class="no">CEmat</span>[ , <span class="no">costsCol</span>] <span class="kw">&lt;=</span> <span class="no">CEmat</span>[<span class="no">highestqaly</span>, <span class="no">costsCol</span>]), ]

<span class="co"># Number of strategies remaining after screening</span>
<span class="no">numStrat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">CEmat</span>)[<span class="fl">1</span>]</pre></body></html></div>
<p><span class="math inline">\(~\)</span></p>
<p>Following this, we find WTP levels to test so that all strategies on frontier will be captured, this requires testing on either side of all NMB intersections, which are simply all the pairwise ICER comparisons. Lastly, we find the strategy with the maximum NMB at each of the WTP test points <code>indicesOfMax</code>, this series creates the HPF. Lastly, we generate the cost-effectiveness results/table.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">outcome.comb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Combination/Outcome-All-Combination-"</span>, <span class="no">CITY</span>, <span class="st">"-DM.rds"</span>))
<span class="no">outcome.ref</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Inputs/Combination-DM-"</span>, <span class="no">CITY</span>, <span class="st">"-refcase-outcomes.rds"</span>)))
<span class="no">combination.list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">"Combination/Combination.list.rds"</span>)

<span class="no">CEthreshold</span> <span class="kw">&lt;-</span> <span class="fl">100000</span>  <span class="co">#cost-effectiveness threshold</span>

<span class="no">frontier.matrix</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">outcome.ref</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"QALYs.sum"</span>, <span class="st">"costs.total.sum"</span>)], <span class="no">outcome.comb</span>[<span class="no">frontier</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"QALYs.sum"</span>, <span class="st">"costs.total.sum"</span>)])

<span class="no">Strategy.ind</span>     <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">frontier</span>)
<span class="no">frontier.matrix</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">Strategy.ind</span>, <span class="no">frontier.matrix</span>)

<span class="no">costsCol</span> <span class="kw">&lt;-</span> <span class="fl">3</span>; <span class="no">qalyCol</span> <span class="kw">&lt;-</span> <span class="fl">2</span>

<span class="no">frontier.matrix</span>[ , <span class="no">qalyCol</span>]  <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>[ , <span class="no">qalyCol</span>]  - <span class="no">frontier.matrix</span>[<span class="fl">1</span>, <span class="no">qalyCol</span>]
<span class="no">frontier.matrix</span>[ , <span class="no">costsCol</span>] <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>[ , <span class="no">costsCol</span>] - <span class="no">frontier.matrix</span>[<span class="fl">1</span>, <span class="no">costsCol</span>]

<span class="no">frontier.matrix</span> <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>[-<span class="fl">1</span>, ]
<span class="no">frontier.matrix</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">frontier.matrix</span>)

<span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="no">frontier.matrix</span>$<span class="no">costs.total.sum</span> <span class="kw">&lt;</span> <span class="fl">0</span>)){
  <span class="no">frontier.matrix</span>$<span class="no">ICER</span>[<span class="no">frontier.matrix</span>$<span class="no">costs.total.sum</span> <span class="kw">&lt;</span> <span class="fl">0</span>] <span class="kw">&lt;-</span> <span class="st">"CS"</span>
  <span class="no">NCS</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">frontier.matrix</span>$<span class="no">costs.total.sum</span> <span class="kw">&lt;</span> <span class="fl">0</span>)  <span class="co">#number of cost savings</span>
  <span class="kw">if</span> (<span class="no">NCS</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)){
    <span class="no">ocis</span>       <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)]
    <span class="no">comparator</span> <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>) - <span class="fl">1</span>]
  } <span class="kw">else</span>{
    <span class="no">frontier.matrix</span>$<span class="no">ICER</span>[(<span class="no">NCS</span>+<span class="fl">1</span>):<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)] <span class="kw">&lt;-</span>
      <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="no">frontier.matrix</span>$<span class="no">costs.total.sum</span>[<span class="no">NCS</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)]) / <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="no">frontier.matrix</span>$<span class="no">QALYs.sum</span>[<span class="no">NCS</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)])
    <span class="no">icer</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">frontier.matrix</span>$<span class="no">ICER</span>[(<span class="no">NCS</span>+<span class="fl">1</span>):<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)])  <span class="co">#ICER for non cost-saving strategies</span>
    <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">icer</span> <span class="kw">&gt;=</span> <span class="no">CEthreshold</span>)){
      <span class="no">ocis</span>       <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="no">NCS</span>]
      <span class="no">comparator</span> <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="no">NCS</span> - <span class="fl">1</span>]
    } <span class="kw">else</span>{
      <span class="no">ocis.ind</span>   <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(<span class="no">icer</span>[<span class="no">icer</span> <span class="kw">&lt;</span> <span class="no">CEthreshold</span>]) + <span class="no">NCS</span>
      <span class="no">ocis</span>       <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="no">ocis.ind</span>]
      <span class="no">comparator</span> <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="no">ocis.ind</span> - <span class="fl">1</span>]
    }
  }

} <span class="kw">else</span>{
  <span class="no">frontier.matrix</span>$<span class="no">ICER</span>[<span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">costs.total.sum</span>[<span class="fl">1</span>] / <span class="no">frontier.matrix</span>$<span class="no">QALYs.sum</span>[<span class="fl">1</span>]
  <span class="no">frontier.matrix</span>$<span class="no">ICER</span>[<span class="fl">2</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">frontier.matrix</span>)] <span class="kw">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="no">frontier.matrix</span>$<span class="no">costs.total.sum</span>) / <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="no">frontier.matrix</span>$<span class="no">QALYs.sum</span>)
  <span class="no">ocis.ind</span>   <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(<span class="no">frontier.matrix</span>$<span class="no">ICER</span>[<span class="no">frontier.matrix</span>$<span class="no">ICER</span> <span class="kw">&lt;</span> <span class="no">CEthreshold</span>])
  <span class="no">ocis</span>       <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="no">ocis.ind</span>]
  <span class="no">comparator</span> <span class="kw">&lt;-</span> <span class="no">frontier.matrix</span>$<span class="no">Strategy.ind</span>[<span class="no">ocis.ind</span> - <span class="fl">1</span>]
}

<span class="no">frontier.list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">frontier.list</span>$<span class="no">frontier</span>   <span class="kw">&lt;-</span> <span class="no">frontier</span>
<span class="no">frontier.list</span>$<span class="no">ocis</span>       <span class="kw">&lt;-</span> <span class="no">ocis</span>
<span class="no">frontier.list</span>$<span class="no">comparator</span> <span class="kw">&lt;-</span> <span class="no">comparator</span>

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">frontier.list</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Combination/ProductionFunction-Frontier-"</span>, <span class="no">CITY</span>, <span class="st">".rds"</span>))

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">frontier.matrix</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Strategy"</span>, <span class="st">"Incremental QALYs"</span>, <span class="st">"Incremental cost"</span>, <span class="st">"ICER"</span>)
<span class="fu">write.xlsx</span>(<span class="no">frontier.matrix</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Outputs/Production Function Table/ProductionFunction.CEAResults-"</span>, <span class="no">CITY</span>, <span class="st">".xlsx"</span>))</pre></body></html></div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="plots" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#plots" class="anchor"></a>5.2 Plots</h1>
<p>The following modules allow users to re-produce and customize the plots and outputs from <span class="citation">(Nosyk et al. 2020)</span>.</p>
<p>To generate a 6 panel graph (one panel for each city) for the PSA ellipses for optimal combination intervention strategies, use <em>CascadeCEA-Interventions-3-Plot-Ellipse(PSA).R</em> found in the <em>R</em> directory. Figure 5.0 provides an example of what is produced using the script.</p>
<div class="figure">
<img src="../figs/04_psa_ellipses.png" alt=""><p class="caption">Figure 5.0 Sample six-panel PSA ellipses figure </p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>To generate plots for the number of new infections each year in each city over time, use <em>CascadeCEA-Interventions-3-Plot-NewIncidence.R</em> found in the <em>03_Analysis</em> folder. Both point estimates and 95% CI are provided.</p>
<div class="figure">
<img src="../figs/06_Incidence.jpg" alt=""><p class="caption">Figure 5.1 Sample incidence plot </p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>To visualize the health production function generated in 5.2 use <em>CascadeCEA-Interventions-3-Plot-ProductionFunction.R</em> found in the <em>R</em> directory. X-axis is “Incremental QALYs (1000s) and Y-axis is “Incremental costs (millions, 2018 USD). This script automatically produces a 6 panel graph (one panel for each city), such as Figure 5.1.</p>
<div class="figure">
<img src="../figs/05_production_function.png" alt=""><p class="caption">Figure 5.2 Sample six-panel Health Production Function (HPF) figure </p>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-core">
<p>Nosyk, B., X. Zang, E. Krebs, B. Enns, J. E. Min, C. N. Behrends, C. Del Rio, et al. 2020. “Ending the Hiv Epidemic in the Usa: An Economic Modelling Study in Six Cities.” Journal Article. <em>Lancet HIV</em> 7 (7): e491–e503. <a href="https://doi.org/10.1016/S2352-3018(20)30033-3">https://doi.org/10.1016/S2352-3018(20)30033-3</a>.</p>
</div>
<div id="ref-CEthreshold">
<p>Woods, Beth, Paul Revill, Mark Sculpher, and Karl Claxton. 2016. “Country-Level Cost-Effectiveness Thresholds: Initial Estimates and the Need for Further Research.” Journal Article. <em>Value in Health</em> 19 (8): 929–35. <a href="https://doi.org/https://doi.org/10.1016/j.jval.2016.02.017">https://doi.org/https://doi.org/10.1016/j.jval.2016.02.017</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Xiao Zang, Emanuel Krebs, Benjamin Enns, Jeong Min, Siyuan Chen, Amanda My Linh Quan, Bohdan Nosyk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
